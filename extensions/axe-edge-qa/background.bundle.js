(()=>{var e,t={28896:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function o(e){try{c(s.next(e))}catch(e){a(e)}}function i(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}c((s=s.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(14206)),o=n(r(91602)),i=(e,t)=>{if(!e)throw new Error(`ml-client: ${t}`)};t.default=class{constructor(e){this.options=e,i(this.options.token,"Token required"),i(this.options.url,"URL required")}formFields({image:e,url:t,vdom:r,maxDistance:s}){return i(e,"Image required"),i(t,"URL required"),i(r,"VDOM required"),this.request({method:"POST",endpoint:"form-fields",body:{image_data:e,url:t,vdom:r,maxDistance:s}})}request({method:e,endpoint:t,body:r}){return s(this,void 0,void 0,(function*(){const s=yield a.default.request({method:e,headers:{Accept:"application/json",Authorization:`Bearer ${this.options.token}`},url:o.default(this.options.url,`/${t}`),data:r,timeout:this.options.timeout||1e4});return i(200===s.status,`"${t}" returned "${s.statusText}"`),s.data}))}}},20467:(e,t,r)=>{"use strict";r.d(t,{Sj:()=>l,Hm:()=>m,Wp:()=>b,aA:()=>h,xJ:()=>w});r(97968);var s=r(72257);r(92833),r(78176),r(87160),r(67322);function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const i=()=>Math.floor(Date.now()/1e3);let c;const l=(e,t)=>{c||(c=new BroadcastChannel("auth")),c.postMessage&&c.postMessage({topic:e,message:t}),s.J.send(s.D.background,e,t)};let u=null,d=null;const p=e=>{const t=a(a({},e),{},{expires_at:i()+e.expires_in,refresh_expires_at:i()+e.refresh_expires_in});l("auth:session",t),(e=>{if((u||d)&&g(),!e)return;const t=1e3*(e.refresh_expires_at-i()-120);u=setTimeout((()=>{l("auth:session",a(a({},e),{},{expires_in:e.expires_at-i(),refresh_expires_in:e.refresh_expires_at-i()}))}),t),d=setTimeout((()=>{f()}),1e3*(e.refresh_expires_at-i()))})(t),browser.storage.local.set({session:t})},f=async()=>{try{const{"sso-config":e,user:t,session:r}=await browser.storage.local.get();await fetch(e.logoutUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:encodeURI(`client_id=${e.publicClientId}&refresh_token=${r.refresh_token}`)}),await browser.storage.local.remove(["sso-config","session","user"]),null!=t&&t.company&&await browser.storage.local.set({cachedUserCompany:t.company}),l("auth:logout"),g(),s.J.send(s.D.background,"extension:logout")}catch(e){const{message:t}=e;l("auth:error",t)}},g=()=>{clearTimeout(u),clearTimeout(d)},m=async()=>{const{axeServerURL:e}=await browser.storage.local.get("axeServerURL");return e&&"default"!==e?e:"https://axe.deque.com"},b=e=>{e instanceof URL||(e=new URL(e));const t=e.searchParams.get("code"),r=e.hash?new URLSearchParams(e.hash.substr(1)).get("code"):null;return t||r||null},h=async()=>{const e=await m(),t=await fetch(`${e}/api/sso-config`);if(!t.ok)throw new Error(`Unable to get SSO config (${t.statusCode})`);const{url:r,realm:s,publicClientId:n}=await t.json();return{url:r,realm:s,publicClientId:n,openIdConnectUrl:`${r}/auth/realms/${s}/protocol/openid-connect`}},w=async()=>{const{session:e,"sso-config":t}=await browser.storage.local.get();if(!e)return;const r={grant_type:"refresh_token",refresh_token:e.refresh_token,client_id:t.publicClientId},s=await fetch(t.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:encodeURI(Object.entries(r).map((([e,t])=>`${e}=${t}`)).join("&"))});if(401===s.status||400===s.status)return void f();200!==s.status&&l("auth:error","Unexpected error");const n=await s.json();return p(n),n};s.J.listen("app:logout",f)},38772:(e,t,r)=>{"use strict";var s=r(39619),n=r.n(s),a=r(87160),o=r.n(a),i=r(72257),c=r(92833),l=r(78176);const u=e=>{try{const t=new URL(e);return e.replace(t.hash,"")}catch(t){return e}};var d=r(20467),p=r(65981);var f=r(26507),g=r(62249);const{NODE_ENV:m,IS_AXE_PRO:b,AXE_PRO_URL:h}={NODE_ENV:"production",COCONUT:"false",EDGE:"true",FIREFOX:"false",IS_AXE_PRO:"true",MANIFEST_VERSION:2,E2E:!1,DOCS_SITE_URL:"https://docs.deque.com/devtools-html",ENV:"production",AXE_PRO_URL:"https://axe.deque.com",USAGE_SERVICE_URL:"https://usage.deque.com",AXE_PRO_ML_SERVICE_URL:"https://axe-ml.deque.com",AMPLITUDE_API_KEY:"a1ce09d0b14ddcc12ab7b508b6606a2f",DATADOG_CLIENT_TOKEN:"puba2eb4ed47c6eb69ce20ef237db754ff8"},w="true"===b;(0,c.L5)(),i.J.listen("identify-content-frame",(({frameId:e})=>e)),browser.tabs.onUpdated.addListener(((e,t,{url:r,title:s})=>{(t.url||t.title)&&i.J.send(i.D.devtools,"page-info:change",{url:u(r),title:s},{tabId:e})})),i.J.listen("get-distinct-id",(async()=>await(0,f.Z)()));if(i.J.listen("auth:login",(()=>browser.storage.local.remove("cachedDistinctId"))),i.J.listen("devtools:open",(async({tabId:e})=>{if(!function(e){return"number"==typeof e&&e>=0}(e))return;const{url:t,title:r}=await browser.tabs.get(e);i.J.send(i.D.devtools,"page-info:init",{url:t,title:r},{tabId:e})})),"production"===m||"test"===m){const e=o()(h);browser.runtime.onInstalled.addListener((async({reason:t})=>{if("install"===t){if("ChromePuppeteerE2E"!==navigator.userAgent){const{name:t,installType:r,version:s}=await browser.management.getSelf();console.log('[%s @ %s] installed with "%s".',t,s,r),(0,c.N9)({enterpriseInstall:["admin","other"].includes(r)}),w&&browser.tabs.create({active:!0,url:`${e}/install-success`})}}else"update"===t&&i.J.send(i.D.devtools,"extension:update")})),w&&browser.runtime.setUninstallURL(`${e}/uninstalled`)}i.J.listen("get-send-metrics",(async()=>{const e=Date.now();let{shouldSendMetrics:t,shouldSendMetricsDeadline:r=0}=await browser.storage.local.get(["shouldSendMetrics","shouldSendMetricsDeadline"]);if(void 0!==t||e<r)return t;try{let{axeServerURL:r}=await browser.storage.local.get("axeServerURL");const s=await fetch(`${"default"===r?h:r}/api/extension/collect-user-data`,{redirect:"follow"});return t=await s.json(),browser.storage.local.set({shouldSendMetrics:t,shouldSendMetricsDeadline:e+3600}),(0,c.Cu)(t),t}catch(e){return!1}})),w&&(r(99121),i.J.listen("navigate",(async({tabId:e,message:t})=>browser.tabs.update(e,{url:t}))),i.J.listen("get-auth-code",(async({message:{loginUrl:e}})=>{try{const t=await fetch(e);return n()(t.ok),(0,d.Wp)(t.url)}catch(e){(0,c.w1)("Unable to fetch auth code",{exception:e})}})),i.J.listen("get-sso-config",(async({message:e})=>{const t=await(0,d.Hm)(),{socialProvider:r}=e;try{const{url:e,realm:s,publicClientId:n,openIdConnectUrl:a}=await(0,d.aA)(),o=new URL(t),i=new URL(`${a}/auth`);o.searchParams.set("fromextension","true"),r&&o.searchParams.set("socialProvider",r),i.searchParams.set("redirect_uri",o.href),i.searchParams.set("client_id",n),i.searchParams.set("response_type","code"),i.searchParams.set("response_mode","query"),i.searchParams.set("scope","openid");const c={authUrl:e,realm:s,publicClientId:n,redirectUrl:o.href,loginUrl:i.href,logoutUrl:`${a}/logout`,tokenUrl:`${a}/token`};return await browser.storage.local.set({"sso-config":c}),c}catch(e){return{error:!0}}})),i.J.listen("get-session",(async({message:e})=>{const{tokenUrl:t,code:r,publicClientId:s,socialProvider:n,redirectUri:a}=e,{axeServerURL:o}=await browser.storage.local.get("axeServerURL"),i=new FormData;i.append("code",r),i.append("grant_type","authorization_code"),i.append("client_id",s),i.append("redirect_uri",a);const c=new URLSearchParams(i).toString();return(await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c})).json()})),i.J.listen("get-session-user",(async({message:e})=>{const{access_token:t}=e,{axeServerURL:r}=await browser.storage.local.get("axeServerURL"),s=await fetch(`${"default"===r?h:r}/api/logged-in`,{headers:{Authorization:`Bearer ${t}`}}),n=await s.json(),a=n&&n.roles&&n.roles.find((e=>l.Z.map((e=>e.name)).includes(e)));return a&&browser.storage.local.set({userJobRole:a}),n})),i.J.listen("app:logout",(async()=>{(await browser.tabs.query({})).forEach((({id:e})=>{i.J.send(i.D.devtools,"app:logout",null,{tabId:e})}))})),i.J.listen("extension:logout",(async()=>{(await browser.tabs.query({})).forEach((({id:e})=>{i.J.send(i.D.content,"extension:logout",null,{tabId:e})}))}))),i.J.listen("analyze:scoped",(async()=>{const{enableServerless:e,sentAnalyticsScoped:t,axeServerURL:r,session:s={}}=await browser.storage.local.get(["enableServerless","sentAnalyticsScoped","axeServerURL","session"]);if(t||e)return;const n="default"===r?h:r;try{(await fetch(`${n}/api/analytics`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({event_name:"axe_first_scoped_test_date"})})).ok&&browser.storage.local.set({sentAnalyticsScoped:!0})}catch(e){}})),i.J.listen("app:plan:change",(()=>{(0,d.Sj)("app:plan:get")})),i.J.listen("fetch-all-ads",(async({tabId:e})=>{let t="";g.i7?t="?browser=chrome":g.un&&(t="?browser=edge");try{const e=await(0,d.Hm)(),r=await fetch(`${e}/api/ads${t}`,{method:"GET"});return{allAds:await r.json()}}catch(t){return p.fy.logger.error(`Failed to fetch ads at ${e}`,{error:t.message,stack:t.stack}),{allAds:[],error:!0}}})),i.J.listen("log:error",(({message:e})=>{const{errorMessage:t,stack:r}=e;p.fy.logger.error(t,r)}))},62249:(e,t,r)=>{"use strict";r.d(t,{un:()=>s,i7:()=>n,q_:()=>a});const s=!0,n=!s,a=()=>s?"edge":"chrome";let o;o=s?"AxeEdge":"AxeChrome"},99121:(e,t,r)=>{"use strict";r.r(t),r.d(t,{TAB_TIMEOUT:()=>je});var s=r(96292),n=r.n(s),a=r(42607);r(28896);const o=()=>chrome.runtime.lastError&&chrome.runtime.lastError.message&&"Cannot attach to this target."===chrome.runtime.lastError.message;function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const l=n()("debugger:command"),u=n()("debugger:response"),d=(e=browser.devtools.inspectedWindow.tabId)=>new Promise(((t,r)=>{try{chrome.debugger.attach({tabId:e},"1.3",(()=>{try{chrome.runtime.lastError?l(chrome.runtime.lastError.message):l(`attach:${e}`)}finally{t(!0)}}))}catch{r()}})),p=async(e,t,r)=>new Promise((s=>{l(`[${t}] command:${e.tabId}`,r),chrome.debugger.sendCommand(e,t,r,(r=>{try{chrome.runtime.lastError&&l(chrome.runtime.lastError.message)}finally{u(`[${t}] command:${e.tabId}`,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},r)),s(r)}}))})),f=(e=browser.devtools.inspectedWindow.tabId)=>new Promise(((t,r)=>{try{chrome.debugger.detach({tabId:e},(()=>{l(`detach:${e}`),t(!0)}))}catch{r()}}));async function g(e,t={}){return p(this,e,t)}const m=async e=>(await d(e),Promise.resolve(g.bind({tabId:e})));class b{constructor(e){this.tabId=e}async start(){if(this.command=await m(this.tabId),o())throw new Error(browser.runtime.lastError.message);await this.command("Input.enable"),await this.fireTab()}stop(){f(this.tabId)}async fireKey(e,t){await this.command("Input.dispatchKeyEvent",{type:"keyDown",windowsVirtualKeyCode:e,code:t,key:t}),await this.command("Input.dispatchKeyEvent",{type:"keyUp",windowsVirtualKeyCode:e,code:t,key:t})}async fireTab(){await this.fireKey(9,"Tab")}async fireEscape(){this.command=await m(this.tabId),await this.command("Input.enable"),await this.fireKey(27,"Escape"),this.stop()}}var h=r(72257),w=r(39619),y=r.n(w),v=r(11719),O=r(20467);const I=n()("request-interception"),_=["get","post","put","delete"],P=function(){const e=new Map(_.map((e=>[e,[]])));for(const t of _)this[t]=(r,s)=>{if(_.includes(t)){const n=e.get(t);e.set(t,[...n,{pattern:r,handler:s}])}return this};return this.intercept=(t,r,s)=>{const n=t.toLowerCase();if(!_.includes(n))return!1;for(const{pattern:t,handler:a}of e.get(n)){const e=new URLPattern({pathname:t}),[o,i]=r.split("?"),c=e.exec(o,"https://axe.deque.com");if(c){const e=c.pathname.groups,r=Object.fromEntries(new URLSearchParams(i));return I(`${n} ${t}`,{endpoint:o,params:e,query:r,body:s}),a(s,{endpoint:o,params:e,query:r})}}},this};new Error("timeout while waiting for mutex to become available"),new Error("mutex already locked");const j=new Error("request for lock canceled");var E=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function o(e){try{c(s.next(e))}catch(e){a(e)}}function i(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}c((s=s.apply(e,t||[])).next())}))};class x{constructor(e,t=j){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(((t,r)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:r}),this._dispatch()}))}runExclusive(e,t=1){return E(this,void 0,void 0,(function*(){const[r,s]=yield this.acquire(t);try{return yield e(r)}finally{s()}}))}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()}))}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach((e=>e.forEach((e=>e.reject(this._cancelError))))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){const r=null===(e=this._weightedQueues[t-1])||void 0===e?void 0:e.shift();if(!r)continue;const s=this._value,n=t;this._value-=t,t=this._value+1,r.resolve([s,this._newReleaser(n)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach((e=>e())),this._weightedWaiters[e-1]=[])}}var S=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function o(e){try{c(s.next(e))}catch(e){a(e)}}function i(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}c((s=s.apply(e,t||[])).next())}))};function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){R(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const U="appData",T=new class{constructor(e){this._semaphore=new x(1,e)}acquire(){return S(this,void 0,void 0,(function*(){const[,e]=yield this._semaphore.acquire();return e}))}runExclusive(e){return this._semaphore.runExclusive((()=>e()))}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};const L=class{constructor(){this.set=async(e,t)=>this.setAppData(e,t,!1),this.update=async(e,t)=>this.setAppData(e,t,!0)}async setAppData(e,t,r){return await T.runExclusive((async()=>{let{[U]:s={}}=await browser.storage.local.get(U);return t?s[t]=r?$($({},s[t]),e):e:s=e,await browser.storage.local.set({[U]:s}),t?s[t]:s}))}async get(e){return await T.runExclusive((async()=>{const{[U]:t={}}=await browser.storage.local.get(U);return e?t[e]:t}))}async clear(){await browser.storage.local.remove(U)}};function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){A(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function A(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const C=new L,N=new P;N.post("/api/tests",(async e=>{const t=(0,v.v4)();return await C.set(J({id:t,updated_at:(new Date).toISOString(),created_at:(new Date).toISOString(),issues:[],manifests:[]},e),`/api/tests/${t}`)})).put("/api/tests/:testId",(async(e,{params:t})=>{const r=`/api/tests/${t.testId}`;return await C.update(J(J({},e),{},{updated_at:(new Date).toISOString()}),r)})).post("/api/tests/:testId/issues",(async({violations:e=[]},{params:t})=>{const r=`/api/tests/${t.testId}`,s=await C.get(r);for(const r of e)s.issues=[...null==s?void 0:s.issues,J({id:(0,v.v4)(),test_id:t.testId},r)];return await C.update(s,r),e})).put("/api/tests/:testId/issues/:issueId",(async(e,{params:t})=>{const r=`/api/tests/${t.testId}`,s=await C.get(r);let n={};const a=null==s?void 0:s.issues.map((r=>r.id!==t.issueId?r:(n=J(J({},r),e),n)));return await C.set(J(J({},s),{},{issues:a}),r),n})).delete("/api/tests/:testId/issues/",(async(e,{params:t,query:r})=>{const s=`/api/tests/${t.testId}`,n=await C.get(s);await C.set(J(J({},n),{},{issues:(null==n?void 0:n.issues.filter((e=>e.id!==r.id)))||[]}),s)})).post("/api/tests/:testId/manifests",(async(e,{params:t})=>{const r=`/api/tests/${t.testId}`,s=await C.get(r),n={id:(0,v.v4)(),test_id:t.testId,guide:e.guide||e.name,created_at:(new Date).toISOString()};return(s.manifests||[]).push(n),await C.set(s,r),n})).get("/api/tests/:testId/manifests/:manifestId",(async(e,{params:t})=>{const r=await C.get(`/api/tests/${t.testId}`);return(null==r?void 0:r.manifests.find((e=>e.id===t.manifestId)))||{}})).get("/api/tests/:testId/issues",(async(e,{params:t})=>{const r=await C.get(`/api/tests/${t.testId}`);return(null==r?void 0:r.issues)||[]})).get("/api/tests/:testId/manifests",(async(e,{params:t})=>{var r;const s=await C.get(`/api/tests/${t.testId}`);return(null==s||null===(r=s.manifests)||void 0===r?void 0:r.reduce(((e,t)=>{if(t.guide){const r=[...e[t.guide]||[],t];e[t.guide]=r}return e}),{}))||{}})).put("/api/tests/:testId/manifests/:manifestId",(async(e,{params:t})=>{const r=`/api/tests/${t.testId}`,s=await C.get(r);let n={};const a=null==s?void 0:s.manifests.map((r=>r.id!==t.manifestId?r:(n=J(J(J({},r),{},{updated_at:(new Date).toISOString()},"data"in e&&e.data?{body:e.data}:{}),"name"in e&&e.name?{name:e.name}:{}),n)));return await C.set(J(J({},s),{},{manifests:a}),r),n})).delete("/api/tests/:testId/manifests/:manifestId",(async(e,{params:t})=>{const r=`/api/tests/${t.testId}`,s=await C.get(r),n=null==s?void 0:s.issues.filter((e=>e.manifestId!==t.manifestId)),a=null==s?void 0:s.manifests.filter((e=>e.id!==t.manifestId));await C.set(J(J({},s),{},{issues:n||[],manifests:a||[]}),r)})).get("/api/users/:id/tests",(async(e,{query:t})=>{var r;const s=new URLPattern({pathname:"/api/tests/:testId"}),n=await C.get(),a=[],o=(null===(r=t.tags)||void 0===r?void 0:r.split(","))||[];for(const[e,t]of Object.entries(n))if(s.test(e,"https://axe.deque.com")){const e=o.length?t.issues.filter((e=>!!e.tags.find((e=>o.includes(e))))):null==t?void 0:t.issues;a.push(J({best_practice_count:t.issues.filter((e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.includes("best-practice")})).length,needs_review_count:e.filter((e=>!!e.needs_review)).length,violation_count:e.filter((e=>"violation"===e.variant)).length},t))}return a.sort(((e,t)=>-e.updated_at.localeCompare(t.updated_at)))})).post("/api/analytics",(()=>{})).put("*",(async(e,{endpoint:t})=>C.set(e,t))).post("*",(async(e,{endpoint:t})=>C.update(e,t))).get("*",(async(e,{endpoint:t})=>C.get(t))).delete("*",(async(e,{endpoint:t})=>{const r=await C.get();delete r[t],await C.set(r)}));const M=async(e,t,r,s)=>{const{axeServerURL:n,session:o}=await browser.storage.local.get();if(null==o||!o.access_token)throw new Error(a.ZP`You are not logged in and you need to be logged in to perform this action`);let i;if(o.expires_at<Math.floor(Date.now()/1e3)-6e4)try{i=(await(0,O.xJ)()).access_token}catch(e){}const c=await fetch(`${"default"===n?"https://axe.deque.com":n}${t}`,{method:e,headers:J(J({},r),{},{Authorization:`Bearer ${i||o.access_token}`}),body:s});if(401===c.status)throw new Error("access denied");return c},q=async(e,t,r)=>{const{enableServerless:s}=await browser.storage.local.get("enableServerless");if(s)try{return await N.intercept(e,t,r)}catch(e){throw console.error(e),e}const n=await M(e,t,{"Content-Type":"application/json",Accept:"application/json"},JSON.stringify(r));if(204!==n.status)return y()(n.ok),n.json()};const V={delete:function(e,t){return q("DELETE",e,t)},get:function(e){return q("GET",e)},post:function(e,t){return q("POST",e,t)},put:function(e,t){return q("PUT",e,t)},stream:{post:function(e,t,r){return M("POST",e,t,r)},get:function(e,t,r){return M("GET",e,t,r)}}},Z=a.ZP`Your session has expired. Please log back in.`;function F(e,t,r=Z){const s=t&&"access denied"===t.message;h.J.send(h.D.devtools,"app:notification",{type:"caution",text:s?Z:r},{tabId:e}),s&&h.J.send(h.D.devtools,"app:logout",null,{tabId:e})}var G=r(43152),W=r.n(G);const z=[{config:{deprecated:!0}}],K={"buttons-and-links":z,headings:z,lists:z,"page-info":z},X=(e,t)=>t.reduce(((e,t)=>e.find((e=>e.vnodeId===t.vnodeId))?e:[...e,t]),[...e]);function B(e=[],t){const r=W()(t,"metadata.scope",{});return e.reduce(((e,r)=>{const s=t[r];return s?s.vnodeId?X(e,[s]):Array.isArray(s)?X(e,(e=>e.reduce(((e,t)=>t.vnodes?[...e,...t.vnodes]:[...e,t]),e))(s)):e:e}),r?[r]:[]).filter((e=>e&&e.vnodeId))}var Y=r(24379);const H=/^wcag\d{1,2}a{1,3}$/,Q=e=>e.map((e=>{return e.checkpoint&&e.standards.find((e=>H.test(e)))?(t=e.checkpoint)?`wcag${t.replace(/\./g,"")}`:"":"";var t})),ee=(e,t=Y)=>{var r,s;const n=Array.isArray(t)?t.find((t=>t.id===e)):t;return null!=n&&null!==(r=n.data)&&void 0!==r&&r.length?[null===(a=n.data,s=null===(o=a.find((e=>e.standards.find((e=>H.test(e))))))||void 0===o?void 0:o.standards)||void 0===s?void 0:s[0],...Q(n.data)].filter(Boolean):[];var a,o};function te(e,t){if(null==e)return{};var r,s,n=function(e,t){if(null==e)return{};var r,s,n={},a=Object.keys(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){ne(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ne(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ae=(e,t,r=!1)=>se(se({},e),{},{help_url:`${t}/rule-help/en/${e.rule}`,description:e.description||e.summary,variant:r?"best-practice":"violation",tags:e.tags||ee(e.id)});function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){ce(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ce(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function le(e,t){if(null==e)return{};var r,s,n=function(e,t){if(null==e)return{};var r,s,n={},a=Object.keys(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const ue=n()("background:dom");function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function pe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fe(e,t,r){var s;return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){pe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({description:e.description,help:e.help,help_url:e.helpUrl,impact:e.impact,rule:e.id,summary:t.failureSummary||"",source:t.html,selector:t.target||[],is_manual:!1,variant:null!==(s=e.tags)&&void 0!==s&&s.includes("best-practice")?"best-practice":"violation",needs_review:!1,tags:e.tags,remediation:{any:t.any,all:t.all,none:t.none}},r)}function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){be(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function be(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const he=(e,t)=>{const r=e.filter((e=>!!e.impact)),s=[],n=t.selectorMap;for(const e of r)s.push(...e.nodes.map((r=>{const s=me(me({},t),{},{boundingBox:n[JSON.stringify(r.target)]});return delete s.selectorMap,fe(e,r,s)})));return s},we=({violations:e=[],bestPractices:t=[],incomplete:r=[],selectorMap:s={},screenshotId:n})=>{const a={selectorMap:s,screenshotId:n};return[...he(e,a),...he(t,me(me({},a),{},{variant:"best-practice"})),...he(r,me(me({},a),{},{needs_review:!0}))]};var ye=r(99876);function ve(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(r),!0).forEach((function(t){Ie(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ve(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ie(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _e(e,t){if(null==e)return{};var r,s,n=function(e,t){if(null==e)return{};var r,s,n={},a=Object.keys(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}n()("walnut-chrome:background");const Pe=n()("screenshots"),je=200;h.J.listen("needs-review:yes",(async({message:e,tabId:t})=>{try{await V.put(`/api/tests/${e.testId}/issues/${e.issueId}`,{needs_review:!1})}catch(e){F(t,e,a.ZP`There was a problem updating your reviewed issue.`)}})),h.J.listen("needs-review:no",(async({message:e,tabId:t})=>{try{await V.delete(`/api/tests/${e.testId}/issues/?id=${e.issueId}`)}catch(e){F(t,e,a.ZP`There was a problem removing your reviewed your issue.`)}})),h.J.listen("hubspot-user-analytics",(({message:e})=>{const{event:t,value:r}=e;V.post("/api/analytics",{event_name:t,event_value:r})})),h.J.listen("auth:session",(async({message:e})=>{await browser.storage.local.set({session:e})})),h.J.listen("auth:logout",(async()=>{await browser.storage.local.remove("session")})),h.J.listen("save-screenshot",(async({tabId:e,message:t})=>{let{screenshot:r,isFullPage:s=!1}=t;if(r)try{if(/data:image\/\w+;base64,/.test(r)){const[,e]=r.split(",");r=e}const{url:t}=await browser.tabs.get(e),n=new URLSearchParams({url:t,browser_version:navigator.userAgent,extension_version:ye.i8,is_full_page:s}),a=await V.stream.post(`/api/screenshots?${n}`,{Accept:"application/json","Content-Type":"image/png"},r);return(await a.json()).key}catch(t){return void h.J.send(h.D.devtools,"app:notification",{type:"caution",text:a.ZP`There was a problem saving your screenshot. Please try again.`},{tabId:e})}})),h.J.listen("get-screenshot-features",(async({message:e})=>{const{screenshotId:t,vnodes:r,zoom:s,category:n,coordinateOffset:a}=e;try{return V.post(`/api/screenshots/${t}/features?category=${n}`,{vnodes:r.map((({vnodeId:e,role:t,box:r,tightBox:s,tagName:n,states:a})=>({vnodeId:e,role:t,box:r,tightBox:s,tagName:n,states:a}))),zoom:s,coordinateOffset:a})}catch{return{features:[]}}})),h.J.listen("save-results",(async({tabId:e,message:t})=>{const{testName:r}=t,s=_e(t,["testName"]);try{const t=await h.J.send(h.D.content,"request-axe-results",s,{tabId:e});if(t.error)throw new Error(`request-axe-results error: ${t.error.message}`);const{results:n,pageTitle:o,stars:i,metadata:c}=t,{url:l}=n,{id:u}=await V.post("/api/tests",{url:l}),[d,p]=await Promise.all([V.put(`/api/tests/${u}`,{name:r||o||l,metadata:Oe(Oe({},c),{},{axeVersion:s.axeVersion}),stars:i}),V.post(`/api/tests/${u}/issues`,{test_name:r,violations:we(n),event:"auto"})]);return h.J.send(h.D.devtools,"app:notification",{type:"confirmation",text:a.ZP`Your test has been saved.`},{tabId:e}),{record:d,issues:p,manifests:{}}}catch(t){return h.J.send(h.D.devtools,"app:notification",{type:"caution",text:a.ZP`There was a problem saving your test. Please try again.`},{tabId:e}),{record:{},issues:[],manifests:{}}}})),h.J.listen("dom:get-active-element-shadow-root-type",(async({shouldDetachAfterProcess:e=!1,tabId:t})=>{let r;try{r=await d(t)}catch{if(!r||o())return null}let s=null;try{const{result:{objectId:r}}=await p({tabId:t},"Runtime.evaluate",{expression:"\n          /**\n           * From: https://stackoverflow.com/a/61167135\n           * \n           * Return the active element of a page, regardless of shadow root or iframe window.\n           * @returns {HTMLElement}\n           */\n          (function getActiveElement(element = document.activeElement) {\n            const shadowRoot = element.shadowRoot\n            const contentDocument = element.contentDocument\n          \n            if (shadowRoot && shadowRoot.activeElement) {\n              return getActiveElement(shadowRoot.activeElement)\n            }\n          \n            if (contentDocument && contentDocument.activeElement) {\n              return getActiveElement(contentDocument.activeElement)\n            }\n          \n            return element\n          })()\n          "});if(r){var n;const{node:e}=await p({tabId:t},"DOM.describeNode",{objectId:r,pierce:!0});null!=e&&null!==(n=e.shadowRoots)&&void 0!==n&&n.length?s=e.shadowRoots[0].shadowRootType:ue("Active element does not have a shadow root")}else ue("Unable to retrieve the active element RemoteObjectId")}catch(e){ue(`An error ocurred while trying to retrieve the active element shadow type: ${e}`)}finally{e&&await f(t)}return ue(`Active element shadowRootType: ${s}`),s})),h.J.listen("record:get",(async({message:e,tabId:t})=>{if(!e)return{};try{const[t,r]=await Promise.all([V.get(`/api/tests/${e}`),V.get(`/api/tests/${e}/issues`)]);return{record:t,issues:r}}catch(e){return F(t,e,a.ZP`There was a problem loading your test.`),{record:{},issues:[],error:!0}}})),h.J.listen("records:get",(async({message:e,tabId:t})=>{const{userId:r,tags:s,limit:n,offset:o,includeNeedsReview:i=!0,includeBestPractice:c=!0}=e;try{const e=new URLSearchParams({limit:n,offset:o,needs_review:i,best_practice:c});return Array.isArray(s)&&s.length&&e.set("tags",s.join(",")),await V.get(`/api/users/${r}/tests?${e}`)}catch(e){return F(t,e,a.ZP`There was a problem loading your tests.`),[]}})),h.J.listen("record:update",(async({message:e,tabId:t})=>{try{return await V.put(`/api/tests/${e.id}`,e)}catch(e){return F(t,e,a.ZP`There was a problem updating your test.`),{}}})),h.J.listen("record-issue:update",(async({message:e,tabId:t})=>{try{return await V.put(`/api/tests/${e.testId}/issues/${e.id}`,e)}catch(e){return F(t,e,a.ZP`There was a problem updating your issue.`),{}}})),h.J.listen("record-issue:new",(async({message:e,tabId:t})=>{try{return await V.post(`/api/tests/${e.test_id}/issues`,{violations:[e]})}catch(e){return F(t,e,a.ZP`There was a problem creating your issue.`),{}}})),h.J.listen("record:delete",(async({message:{testId:e,hideNotification:t=!1},tabId:r})=>{try{await V.delete(`/api/tests/${e}`),t||h.J.send(h.D.devtools,"app:notification",{text:a.ZP`Your test was successfully deleted.`},{tabId:r})}catch(e){F(r,e,a.ZP`There was a problem deleting your test.`)}})),h.J.listen("manifest:new",(async({message:{testId:e,tool:t}})=>{if(!e||!t)return{};try{return await V.post(`/api/tests/${e}/manifests`,{name:t})}catch(e){return{}}})),h.J.listen("manifest:update",(async({message:e={},tabId:t})=>{const{id:r,testId:s,testName:n,testUrl:o,name:i,showNotificationOnFailure:c=!1,createIssuesOnManifestComplete:l=!0}=e,u=te(e,["id","testId","testName","testUrl","name","showNotificationOnFailure","createIssuesOnManifestComplete"]);if(!s)return{};let d=u;const{metadata:p={}}=u,f=p.type||p.tool;try{if(f&&K[f]){const e=K[f]||{},{vitals:t}=W()(e,"0.config",[]);d=se(se({},u),{},{metadata:se(se({},p),{},{tree:B(t,u)})})}const e=V.put(`/api/tests/${s}/manifests/${r}`,{data:d,name:i});let t;if(l&&u.metadata.complete&&u.metadata.issues){const e=await(async()=>{const{axeServerURL:e}=await browser.storage.local.get("axeServerURL");return"default"===e?"https://axe.deque.com":e})();t=V.post(`/api/tests/${s}/issues`,{manifestId:r,manifestGuideName:f,test_name:n,violations:u.metadata.issues.map((t=>{const r=((e,t=Y)=>t.find((t=>t.id===e)))(t.id);if(!r)return ae(t,e);const s=Array.isArray(r.data)&&!!r.data.find((e=>"best-practice"===e.type));return ae(t,e,s)}))})}const[a]=await Promise.all([e,t]);return a}catch(e){c&&h.J.send(h.D.devtools,"app:notification",{type:"caution",text:a.ZP`There was an issue updating your test. Please try again.`},{tabId:t})}})),h.J.listen("manifests:get",(async({message:e})=>{if(!e)return[];try{return await V.get(`/api/tests/${e}/manifests`)}catch(e){return[]}})),h.J.listen("manifest:delete",(async({message:e,tabId:t})=>{const{testId:r}=e,s=te(e,["testId"]);if(r)try{await V.delete(`/api/tests/${r}/manifests/${s.id}`)}catch(e){return void h.J.send(h.D.devtools,"app:notification",{type:"caution",text:a.ZP`Unable to delete`},{tabId:t})}})),h.J.listen("guided:start",(async({message:e})=>{const{tabId:t}=e,r=le(e,["tabId"]);try{const{tool:e,username:s,startedFrom:n="record"}=r,a=le(r,["tool","username","startedFrom"]),{testUrl:o}=a;h.J.send(h.D.devtools,"guide:start-guided",{tool:e,testUrl:o,username:s,resume:!1,startedFrom:n,manifest:a},{tabId:t})}catch(e){F(t,e,a.ZP`There was a problem starting your ${"Intelligent Guided Test"}.`)}})),h.J.listen("guided:resume",(async({message:e})=>{e.test_id&&h.J.send(h.D.devtools,"guide:start-guided",{tool:e.guide,ensureTestTab:!0,testUrl:e.body.metadata.url,username:e.body.metadata.username,resume:!0,manifest:ie({id:e.id,testId:e.test_id,testName:e.testName,testUrl:e.testUrl},e.body)},{tabId:e.tabId})})),h.J.listen("guided:save-and-quit",(({message:e})=>{h.J.send(h.D.devtools,"guided:save-and-quit",{},{tabId:e.tabId})})),(()=>{let e;h.J.listen("modal:tabber-init",(async({tabId:t})=>{e&&e.stop(),e=new b(t);try{await e.start()}catch{h.J.send(h.D.content,"attach:failed",{},{tabId:t})}})),h.J.listen("modal:fire-tab",(()=>{e&&e.fireTab()})),h.J.listen("modal:tabber-stop",(()=>{e&&(e.stop(),e=null)})),h.J.listen("modal:fire-escape",(async({tabId:t})=>(e&&e.stop(),e=new b(t),await e.fireEscape(),!0)))})(),h.J.listen("tab-record:new-window-listener:attach",(({tabId:e})=>{const t=()=>{browser.tabs.onCreated.removeListener(r),h.J.unlisten("tab-record:new-window-listener:detach",t)},r=()=>{h.J.send(h.D.content,"tab-record:new-window:launched",null,{tabId:e})};t(),browser.tabs.onCreated.addListener(r),h.J.listen("tab-record:new-window-listener:detach",t)})),h.J.listen("resave-automatic-tests",(async({tabId:e,message:t})=>{const{testId:r,axeResults:s,metadata:n}=t;try{await V.delete(`/api/tests/${r}/issues?is_manual=false`),await V.post(`/api/tests/${r}/issues`,{violations:we(s),event:"auto"});const e=await V.put(`/api/tests/${r}`,{metadata:Oe(Oe({},n),{},{axeVersion:s.axeVersion})});return{updatedIssues:await V.get(`/api/tests/${r}/issues`),auto_tests_at:(new Date).toISOString(),updated_at:e.updated_at}}catch(t){return h.J.send(h.D.devtools,"app:notification",{type:"caution",text:a.ZP`There was a problem saving your automated results. Your test record was not updated, please try again.`},{tabId:e}),{}}}));h.J.listen("forms:ml",(async({tabId:e,message:t})=>{const{url:r,form:s,screenshot:n}=t,{session:a,axeSettings:o,policySettings:i}=await browser.storage.local.get(["session","axeSettings","policySettings"]);if(!(i.DisableAllScreenshots||"boolean"!=typeof i.EnableMachineLearning?o.enableMachineLearning:i.EnableMachineLearning)||!a||!n)return[];const c=await h.J.send(h.D.content,"forms:get-descendant-elements",{vnodeId:s.vnodeId},{tabId:e}),[,l]=n.split("base64,");return await(async e=>await Promise.race([e,new Promise((e=>setTimeout(e,4e3)))]))(new Promise((async e=>{try{e((await V.post("/api/ml/form-fields",{url:r,image:l,vdom:c})).fields)}catch(t){e([])}})))||[]})),h.J.listen("automatic-color-contrast",(async({message:e})=>{const{imageWithText:t,imageWithoutText:r,expectedTextColor:s}=e;if(t&&Pe.enabled){(new Image).src=`data:image/png;base64,${t}`}if(r&&Pe.enabled){(new Image).src=`data:image/png;base64,${r}`}return await V.post("/api/automatic-color-contrast",{imageWithText:t,imageWithoutText:r,expectedTextColor:s})}));const Ee=e=>{const t=globalThis.__tabbers||(globalThis.__tabbers={});if(!t[e]){const r=new b(e);t[e]=r}return t[e]};h.J.listen("tab-record:start",(async({tabId:e})=>{await h.J.send(h.D.content,"tab-record:initial-focus",null,{tabId:e});const t=Ee(e);try{await t.start()}catch{h.J.send(h.D.content,"attach:failed",{},{tabId:e})}})),h.J.listen("tab-record:fire-tab",(async({tabId:e})=>new Promise((t=>{setTimeout((()=>{var r;null===(r=Ee(e))||void 0===r||r.fireTab(),t()}),je)})))),h.J.listen("tab-record:stop",(({tabId:e})=>{var t;null===(t=Ee(e))||void 0===t||t.stop(),delete globalThis.__tabbers[e]})),browser.tabs.onUpdated.addListener(((e,t)=>{const{status:r}=t;"complete"===r&&h.J.send(h.D.devtools,"page:navigation",t,{tabId:e})}))},37551:(e,t,r)=>{"use strict";r.d(t,{ZK:()=>a});let s=console;const n=()=>{const e={NODE_ENV:"production",COCONUT:"false",EDGE:"true",FIREFOX:"false",IS_AXE_PRO:"true",MANIFEST_VERSION:2,E2E:!1,DOCS_SITE_URL:"https://docs.deque.com/devtools-html",ENV:"production",AXE_PRO_URL:"https://axe.deque.com",USAGE_SERVICE_URL:"https://usage.deque.com",AXE_PRO_ML_SERVICE_URL:"https://axe-ml.deque.com",AMPLITUDE_API_KEY:"a1ce09d0b14ddcc12ab7b508b6606a2f",DATADOG_CLIENT_TOKEN:"puba2eb4ed47c6eb69ce20ef237db754ff8"}.LOGGING_ENABLED;return"1"===e||"true"===e},a=(...e)=>{n()&&s.warn(...e)}},92833:(e,t,r)=>{"use strict";r.d(t,{Cu:()=>B,N9:()=>ee,L5:()=>ae,w1:()=>ie});var s=r(48042),n=r.n(s),a=r(65981),o=r(72715),i=r(99876),c=r(72257),l=r(18188),u=r(37551),d=r(64303),p=r(26507);function f(e,t){if(null==e)return{};var r,s,n=function(e,t){if(null==e)return{};var r,s,n={},a=Object.keys(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const{AMPLITUDE_API_KEY:h,DATADOG_CLIENT_TOKEN:w,NODE_ENV:y}={NODE_ENV:"production",COCONUT:"false",EDGE:"true",FIREFOX:"false",IS_AXE_PRO:"true",MANIFEST_VERSION:2,E2E:!1,DOCS_SITE_URL:"https://docs.deque.com/devtools-html",ENV:"production",AXE_PRO_URL:"https://axe.deque.com",USAGE_SERVICE_URL:"https://usage.deque.com",AXE_PRO_ML_SERVICE_URL:"https://axe-ml.deque.com",AMPLITUDE_API_KEY:"a1ce09d0b14ddcc12ab7b508b6606a2f",DATADOG_CLIENT_TOKEN:"puba2eb4ed47c6eb69ce20ef237db754ff8"},v=n().getInstance(),O="conversion:install",I="conversion:uninstall",_="user:login",P="user:open",j="analysis:analyze",E="record:delete",x="record:rename",S="analysis:complete",D="issues:export",$="issue:inspected",R="issue:relatedInspected",U="issue:toggleHighlight",T="issue:moreInfo",L="ml:suggestedInteractiveElement",k="ml:suggestedInteractiveElementRejected",J="ml:missedInteractiveElement",A="ml:suggestedRole",C="ml:suggestedRoleAccepted",N="ml:suggestedRoleRejected",M="ml:suggestedTableHeader",q="ml:suggestedTableHeaderRejected",V="ml:suggestedNotDataCell",Z="ml:suggestedNotDataCellAccepted",F=(e=[],t)=>e.filter((({impact:e})=>e===t)).reduce(((e,{nodes:t})=>e+((null==t?void 0:t.length)||1)),0),G=e=>{try{const t=new URL(e);return"localhost"===t.hostname||!!t.port||"file://"===t.origin}catch(e){return!1}},W=e=>{if(void 0===e)return;const t={failedRuleCount:e.length,failedRuleNames:e.map((e=>e.rule||e.id)),criticalIssueCount:F(e,"critical"),seriousIssueCount:F(e,"serious"),moderateIssueCount:F(e,"moderate"),minorIssueCount:F(e,"minor")};if(e.length&&Array.isArray(e[0].nodes)){const r=e.reduce(((e,t)=>e+t.nodes.length),0);t.failedItemCount=r}return t},z=async e=>{const t=await(0,l.V)(),{productName:r,productComponent:s}=t,n=m(m({},e),{},{productName:r,productComponent:s});try{let{event:e}=n,t=f(n,["event"]);oe(e,t)}catch(e){u.ZK("Analytics Data Error",{error:e.message,stack:e.stack})}try{t.postEvent(n)}catch(e){u.ZK("Usage Data Error",{error:e.message,stack:e.stack})}},K=e=>{let t="anonymous";switch(null==e?void 0:e.status){case d.nf:t="trial";break;case d.N2:case d.Ph:case d.iI:case d.gi:case d.v8:case d.DP:t=e.status}return t},X=async(e=[])=>{let t,r,s,n;if("devtools"in browser)try{({contentType:t,title:r,url:s,scoped:n}=await c.J.send(c.D.content,"get-document-metadata"))}catch(e){a.fy.logger.error("Unable to get document metadata",{error:e.message,stack:e.stack})}const{usageOrganization:l,usageDepartment:u,usageApplication:d,user:f,cachedUserCompany:g,axeSettings:b,userJobRole:h}=await browser.storage.local.get(["usageOrganization","usageDepartment","usageApplication","user","axeSettings","userJobRole"]),w=!(!f||!f.id);return{distinctId:await(0,p.Z)(),organization:l||((null==f?void 0:f.company)||g||""),department:u||"",application:d||"",userStatus:K(f),loggedIn:w,devInstance:G(s),keycloakId:f&&f.id,userId:f&&f.username,userJobRole:h||"Anonymous",productName:"axe-pro",productComponent:"extension",productComponentVersion:i.i8,applicationProperties:m({engineVersion:o.i8,scoped:n,target:s,targetMedium:t,targetState:r,experimental:!1,rulesetName:"wcag2aa",bestPractices:!!b&&!!b.enableBestPractices},W(e))}},B=async e=>{(await(0,l.V)()).enableTracking(e&&!0)},Y=e=>async function(t,r){const s=await X(t);if(!r)return z(m(m({},s),{},{event:e}));z(m(m({},s),{},{event:e,applicationProperties:m(m({},s.applicationProperties),r)}))},H=e=>t=>Y(e)(void 0,t),Q=(Y("issue:viewed"),H($),H(R),H(U),H(T),Y(E),Y(x),Y(O)),ee=async e=>{const{hasSentInstallEvent:t}=await browser.storage.sync.get(["hasSentInstallEvent"]);t||(await browser.storage.sync.set({hasSentInstallEvent:!0}),Q([],e))},te=(Y(I),Y(_),Y(P),(e,t="interactive-elements")=>r=>Y(e)(void 0,m({eventTool:t},r)));te(L),te(k),te(J),te(A),te(C),te(N),te(M,"table"),te(q,"table"),te(V,"table"),te(Z,"table");let re=!1,se=!1;const ne=async()=>{if(re)return;const e=await(0,p.Z)();v.init(h,void 0,{deviceId:e,includeUtm:!0,saveParamsReferrerOncePerSession:!1,includeGclid:!0,includeReferrer:!0,secureCookie:!0,sameSiteCookie:"Lax"}),re=!0},ae=()=>{se||(a.fy.init({clientToken:w,site:"datadoghq.com",service:"axe-extension",env:y,version:i.i8,beforeSend:e=>{var t;if(0===(null==e||null===(t=e.http)||void 0===t?void 0:t.status_code))return!1}}),se=!0)},oe=async(e,t={})=>{await(async()=>{await Promise.all([ne(),ae()])})();let r={};switch(e){case j:r={analyze:1};break;case S:r={complete:1};break;case D:r={export:1}}await(async(e={})=>{const{user:t,userJobRole:r="",usageOrganization:s="",cachedUserCompany:n,axeSettings:a,highlightTheme:o,theme:i,locale:c,policySettings:l,axeServerURL:u,firstView:d,exportFormat:p}=await browser.storage.local.get(["user","userJobRole","usageOrganization","cachedUserCompany","axeSettings","highlightTheme","theme","locale","policySettings","axeServerURL","firstView","exportFormat"]);v.setUserId(t&&t.id);const f=t&&t.id,g=(new v.Identify).set("role",r).set("userStatus",K(t)).set("loggedIn",f).set("axeSettings",m({highlightTheme:o,theme:i,locale:c,axeServerURL:u},a)).set("policySettings",l).set("firstView",d).set("exportSchema",p||"devtools");for(const[t,r]of Object.entries(e))isNaN(r)?g.set(t,r):g.add(t,r);v.identify(g),v.setGroup("organization",s||(null==t?void 0:t.company)||n)})(r);const{devInstance:s,productName:n,productComponent:a,productComponentVersion:o,engineVersion:i,applicationProperties:c}=t,l=m({devInstance:s,productName:n,productComponent:a,productComponentVersion:o,engineVersion:i},c);v.logEvent(e,l)},ie=(e,t={})=>{e?a.fy.logger.error(e,t):a.fy.logger.error("Unknown exception")}},72257:(e,t,r)=>{"use strict";r.d(t,{J:()=>p,D:()=>f});var s=r(96292),n=r.n(s);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const c=n()("bridge"),l=n()("bridge:message"),u=n()("bridge:response"),d={devtools:"devtools",content:"content-script",background:"background",unknown:"unknown"};const p=new class{constructor(){i(this,"listener",((e,t)=>{const{origin:r,context:s,topic:n,message:a,options:o}=e,{tab:i,frameId:c}=t,u=i&&-1!==i.id?i.id:null==o?void 0:o.tabId;if(!r)return;if(this.context===d.background&&s===d.content)return this.send(s,n,a,{tabId:o.tabId||u,frameId:o.frameId,allFrames:o.allFrames});const p=this.context!==d.devtools||browser.devtools.inspectedWindow.tabId===u;if(s!==this.context||!p)return;l(`[${n}] ${r} â†’ ${this.context}: %O`,void 0!==a?a:"");const f=this.getListeners(n),g=e=>{console.error(e)};try{for(var m of f){const e=m({context:s,topic:n,message:a,origin:r,tabId:u,frameId:c});if(!m.isGlobal&&void 0!==e)return Promise.resolve(e).catch(g)}}catch(e){g(e)}}));const{context:e}=this;if(this.messageListeners=new Map,e!==d.unknown){if(!e)throw new Error(`Unsupported bridge context: ${e}`);this.attachListener()}}attachListener(){const{context:e,listener:t}=this;browser.runtime.onMessage.hasListener(t)||(c("bridge initialized with context %s",e),browser.runtime.onMessage.addListener(t)),window.addEventListener("pageshow",(r=>{r.persisted&&!browser.runtime.onMessage.hasListener(t)&&(c("bridge initialized with context %s (cached page)",e),browser.runtime.onMessage.addListener(t))})),window.addEventListener("beforeunload",(()=>{browser.runtime.onMessage.removeListener(t)}))}get context(){return"undefined"==typeof browser?d.unknown:browser&&browser.devtools?d.devtools:browser&&browser.tabs?d.background:browser&&browser.storage?d.content:void 0}async send(e,t,r,{tabId:s,frameId:n=0,allFrames:a=!1}={}){if("undefined"==typeof browser)return;s||this.context!==d.devtools||(s=browser.devtools.inspectedWindow.tabId);let i=browser.runtime.sendMessage;if(e===d.content&&void 0!==browser.tabs){const e={frameId:a?null:n};i=t=>browser.tabs.sendMessage(s,o(o({},t),{},{options:o(o({},t.options),e)}),e)}const c=`${this.context}${this.context===d.devtools?`:${s}`:""}`,p=`${e}${[e,this.context].includes(d.content)&&s?`:${s}`:""}`;l(`[${t}] ${c} â†’ ${p}: %O`,void 0!==r?r:"");const f={origin:c,context:e,topic:t,message:r,options:e===d.content?{tabId:s,frameId:n,allFrames:a}:{tabId:s}};let g=null;try{g=await i(f)}catch(e){if("Could not establish connection. Receiving end does not exist."!==e.message)throw e}return null!==g&&u(`[${t}] ${p} â†’ ${c}: %O`,g),g}getListeners(e){const{messageListeners:t}=this;return e&&"*"!==e?[...t.get(e)||[],...t.get("*")||[]]:t.get("*")||[]}listen(e,t){const{messageListeners:r}=this,s=r.get(e)||[];"function"==typeof e&&(t=e,e="*"),"*"===e&&(t.isGlobal=!0),"function"==typeof t&&(s.length?r.set(e,[...s,t]):r.set(e,[t]))}unlisten(e,t){const{messageListeners:r}=this;if("function"==typeof e&&(t=e,e="*"),"function"!=typeof t)return;const s=(r.get(e)||[]).filter((e=>e!==t));s.length?r.set(e,s):r.delete(e)}},f=d},18188:(e,t,r)=>{"use strict";r.d(t,{V:()=>l});var s=r(45741),n=r.n(s),a=r(62249);const o={coconut:"extension-coconut",chrome:"extension-chrome",firefox:"extension-firefox",edge:"extension-edge"};let i,c;const l=async(e=!1,t)=>{let{usageServerURL:r}=await browser.storage.local.get("usageServerURL");return!e&&i&&r===c||(c=r,"default"===r&&(r="https://usage.deque.com"),i=new(n())("axe-devtools-html",o[t||(0,a.q_)()]),i.url(r)),i}},64303:(e,t,r)=>{"use strict";r.d(t,{v8:()=>s,nf:()=>n,iI:()=>a,gi:()=>o,N2:()=>i,Ph:()=>c,DP:()=>l});const s="free",n="trialing",a="trial_ended",o="trial_payment_failed",i="paid",c="paid_payment_failed",l="free_payment_failed"},78176:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var s=r(42607);const n=[{name:"Developer",label:s.ZP`Developer`},{name:"Tester",label:s.ZP`Tester`},{name:"Designer",label:s.ZP`Designer`},{name:"Accessibility Specialist",label:s.ZP`Accessibility Specialist`},{name:"Manager",label:s.ZP`Manager`},{name:"Other",label:s.ZP`Other`}]},26507:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var s=r(28020),n=r.n(s);let a;async function o(){if(a)return a;const{axeServerURL:e,session:t}=await browser.storage.local.get(["axeServerURL","session"]);return a=await n()({host:"default"===e?"https://axe.deque.com":e,origin:window.location.origin,token:t&&t.access_token}),a}},67322:(e,t,r)=>{"use strict";r(62249)},91602:function(e,t,r){var s,n,a;a=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var s=0;s<e.length;s++){var n=e[s];if("string"!=typeof n)throw new TypeError("Url must be a string. Received "+n);""!==n&&(s>0&&(n=n.replace(/^[\/]+/,"")),n=s<e.length-1?n.replace(/[\/]+$/,""):n.replace(/[\/]+$/,"/"),t.push(n))}var a=t.join("/"),o=(a=a.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return a=o.shift()+(o.length>0?"?":"")+o.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=a():void 0===(n="function"==typeof(s=a)?s.call(t,r,t,e):s)||(e.exports=n)},360:e=>{"use strict";e.exports=URL},96553:()=>{},72715:e=>{"use strict";e.exports={i8:"4.6.3"}},99876:e=>{"use strict";e.exports={i8:"4.49.1"}}},r={};function s(e){var n=r[e];if(void 0!==n)return n.exports;var a=r[e]={exports:{}};return t[e].call(a.exports,a,a.exports,s),a.exports}s.m=t,e=[],s.O=(t,r,n,a)=>{if(!r){var o=1/0;for(u=0;u<e.length;u++){for(var[r,n,a]=e[u],i=!0,c=0;c<r.length;c++)(!1&a||o>=a)&&Object.keys(s.O).every((e=>s.O[e](r[c])))?r.splice(c--,1):(i=!1,a<o&&(o=a));if(i){e.splice(u--,1);var l=n();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[r,n,a]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.j=352,(()=>{var e={352:0};s.O.j=t=>0===e[t];var t=(t,r)=>{var n,a,[o,i,c]=r,l=0;if(o.some((t=>0!==e[t]))){for(n in i)s.o(i,n)&&(s.m[n]=i[n]);if(c)var u=c(s)}for(t&&t(r);l<o.length;l++)a=o[l],s.o(e,a)&&e[a]&&e[a][0](),e[o[l]]=0;return s.O(u)},r=this.webpackChunk=this.webpackChunk||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var n=s.O(void 0,[736],(()=>s(38772)));n=s.O(n)})();